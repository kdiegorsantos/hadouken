hadouken - A simple inventory system with python and sqlite3
============

This ansible role was made to reach the following requisites.

+ Collect information about hardware and software from Linux servers.
+ Update a sqlite3 database with this informations.

The tasks will be the following.

+ Distribute and execute the hadouken.py script on the servers.
+ Collect the json file that was generated by hadouken.py from each server.
+ Execute the db.py script to update the sqlite database.

Requirements
------------

+ ansible 1.4 or higher

Dependencies
------------

+ python 2.x on servers to run hadouken.py.
+ dmidecode on servers to run hadouken.py.
+ python 2.7 on ansible server.
+ sqlite3 on ansible server.

On the ansible server install the package sqlite3 and create a new database.

Installation on ansible server:
```sh
$ yum install sqlite3
```
Installation on other servers:
```sh
$ yum install dmidecode
```

Database creation on ansible server (there's already a database on files/db folder, but if you want to create yours):
```sh
$ sqlite3 /etc/ansible/roles/hadouken/files/db/db.sqlite < files/sql/create_db.sql
```

Short example:


Installation
------------

Install using ansible-galaxy.

```sh
$ mkdir -p /etc/ansible/roles
$ cd /etc/ansible/roles
$ ansible-galaxy install kdiegorsantos.hadouken
```

Example Playbook
----------------

Create a group in your hosts ansible file named hadouken and fill with desired hosts.
```sh
$ cat <EOF> /etc/ansible/hosts
[hadouken]
webserver
dbserver
EOF
```


After change the default domain variable you can run this role using the ansible-playbook command.

```sh
$ ansible-playbook /etc/ansible/roles/hadouken/role.yml
```

Example hadouken.py
----------------

If you want to run hadouken.py on a host.

```sh
$ hadouken.py
server_name: snelnxa72 
server_release: Red Hat Enterprise Linux Server release 5.11 (Tikanga)
server_site: SNE
server_vendor:  HP
server_model:  ProLiant BL460c Gen8
server_serial: BRC2532JH4
server_cpu: Intel Xeon CPU E5-2650 2.00GHz / 2 Socket(s) / 32 CPU(s)/ 8 Core(s) per socket
server_memory: 32 GB 
server_ip: 10.168.81.77
server_cluster: idem_cluster 
server_clusternodes: snelnx187 snelnx189 snelnxa36 snelnxa68 snelnxa69 snelnxa70 snelnxa71 snelnxa72 snelnxa73
server_frame: 000290102907 000592600076 000595700007 000595700008 CKM00154803864
server_wwpn: 10006c3be5b076f1 10006c3be5b076f5 
server_db: None
```
If you want to display the content of a json file generatedby hadouken.py.

```sh

$ cat /var/tmp/snenix002.json | python -m json.tool
{
    "server_cluster": "",
    "server_clusternodes": "",
    "server_cpu": "2 Socket(s) Intel Xeon CPU E5540 @ 2.53GHz/ 16 CPU(s)/ 4 Core(s) per socket",
    "server_db": "",
    "server_frame": "",
    "server_ip": "10.168.90.103",
    "server_memory": "32 GB",
    "server_model": "ProLiant BL460c G6",
    "server_name": "snenix002",
    "server_release": "Red Hat Enterprise Linux Server release 6.8 (Santiago)",
    "server_serial": "BRC952N120",
    "server_site": "SNE",
    "server_vendor": "HP",
    "server_wwpn": ""
}
```

Example db.sqlite
----------------

If you want to query information about a host.

```sh
$ sqlite3 -header -column /etc/ansible/roles/files/db/db.sqlite "select * from info where server_name = 'snelnxa72'"
server_id   server_name  server_release                                          server_site  server_vendor  server_model        server_serial  server_cpu                                                                   server_memory  server_ip      server_cluster  server_clusternodes  server_frame  server_wwpn  server_db   server_owner  server_rack  server_console  last_update
----------  -----------  ------------------------------------------------------  -----------  -------------  ------------------  -------------  ---------------------------------------------------------------------------  -------------  -------------  --------------  -------------------  ------------  -----------  ----------  ------------  -----------  --------------  -----------
1           snenix002    Red Hat Enterprise Linux Server release 6.8 (Santiago)  SNE          HP             ProLiant BL460c G6  BRC952N120     2 Socket(s) Intel Xeon CPU E5540 @ 2.53GHz/ 16 CPU(s)/ 4 Core(s) per socket  32 GB          10.168.90.103                                                                                                                         2016-09-23 

```

License
-------

This project is licensed under the MIT license. See included LICENSE.md.


Author Information
-------

* Diego R. Santos
* [github.com](https://github.com/kdiegorsantos)

